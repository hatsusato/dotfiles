#!/bin/bash

set -eu
source "${BASH_SOURCE%/*}"/function/apt-register
source "${BASH_SOURCE%/*}"/function/apt-is-installed

no-option() {
  local arg
  for arg; do
    [[ $arg == -* ]] && return 1
  done
  return 0
}
all-installed() {
  local pkg
  for pkg; do
    apt-is-installed "$pkg" || return
  done
  return 0
}
main() {
  local sudo=
  if [[ ${1-} == --sudo ]]; then
    shift
    sudo+=sudo
    command -v sudo-askpass >/dev/null && sudo+=-askpass
  fi
  if [[ ${1-} == install ]] && no-option "$@"; then
    shift
    all-installed "$@" && return
    $sudo apt install "$@" || return
    apt-register "$@"
  else
    $sudo apt "$@"
  fi
}

main "$@"

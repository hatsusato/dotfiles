#!/bin/bash
# depends: (pinentry-askpass) sudo
set -eu

use-askpass() {
  [[ -v DISPLAY ]] || return
  command -v pinentry-askpass
}

if use-askpass >/dev/null; then
  export SUDO_ASKPASS=$(use-askpass)
  export PINENTRY_ASKPASS_PROMPT='Authentication Required'
  export PINENTRY_ASKPASS_DESC="[sudo] password for $USER:"
  export PINENTRY_ASKPASS_OK=Authenticate
  export PINENTRY_ASKPASS_ASK=GETPIN
  set -- -A "$@"
fi
/usr/bin/sudo "$@"
